{
  "$schema": "https://raw.githubusercontent.com/GabrielHCataldo/gopen-gateway/main/GOpen-schema.json",
  "version": "v1.0.0",
  "port": 8080,
  "hot-reload": true,
  "timeout": "5m",
  "store": {
    "redis": {
      "address": "$REDIS_URL",
      "password": "$REDIS_PASSWORD"
    }
  },
  "cache": {
    "duration": "1m",
    "strategy-headers": [
      "X-Forwarded-For",
      "Device"
    ],
    "allow-cache-control": true
  },
  "limiter": {
    "max-header-size": "1MB",
    "max-body-size": "3MB",
    "max-multipart-memory-size": "10MB",
    "rate": {
      "capacity": 1,
      "every": "1s"
    }
  },
  "security-cors": {
    "allow-origins": [
      "*"
    ],
    "allow-methods": [
      "*"
    ],
    "allow-headers": [
      "*"
    ]
  },
  "middlewares": {
    "save-device": {
      "host": [
        "http://192.168.1.2:8051"
      ],
      "path": "/devices",
      "method": "PUT",
      "forward-headers": [
        "*"
      ],
      "modifiers": {
        "header": [
          {
            "context": "RESPONSE",
            "scope": "REQUEST",
            "global": true,
            "action": "SET",
            "key": "X-Device-Id",
            "value": "#response.body.id"
          }
        ]
      },
      "extra-config": {
        "omit-request-body": true
      }
    }
  },
  "endpoints": [
    {
      "@comment": "Feature: USER FindUserByKey",
      "path": "/users/find/:key",
      "cache": {
        "duration": "30s"
      },
      "method": "GET",
      "response-encode": "JSON",
      "beforeware": [
        "save-device"
      ],
      "backends": [
        {
          "host": [
            "http://192.168.1.2:8090"
          ],
          "path": "/users/find/:key",
          "method": "GET"
        }
      ]
    },
    {
      "@comment": "Feature: USER CreateUser",
      "path": "/users",
      "method": "POST",
      "beforeware": [
        "save-device"
      ],
      "backends": [
        {
          "host": [
            "http://192.168.1.2:8090"
          ],
          "path": "/users",
          "method": "POST"
        }
      ]
    }
  ]
}
